Ğ¢Ğ¾Ğ³Ğ´Ğ° Ğ²Ğ¾Ñ‚ ĞºĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ñ‹Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ‚Ğ°ÑĞºĞµ Ñ Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¼ Jinja2:
---
- name: Build flink_job dictionary
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Collect flink_job -> host mapping
      set_fact:
        flink_job_map: >-
          {{
            dict(
              groups['test_flink']
              | map('extract', hostvars)
              | map('community.general.dict_kv', 'flink_job', 'inventory_hostname')
              | sum(start=[])
            )
          }}

    - name: Show flink_job_map
      debug:
        var: flink_job_map



---
- name: Build flink_job dictionary
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Build dictionary of job -> host
      set_fact:
        flink_job_map: >-
          {{
            dict(
              groups['test_flink']
              | map('extract', hostvars)
              | map('combine', [{'jobs': (item.flink_job | default([])) }])
              | map('extract', 'inventory_hostname')
              | list
            )
          }}
      when: false


---
- name: Build flink_job dictionary
  hosts: test_flink
  gather_facts: false
  tasks:
    - name: Init empty dictionary on first host
      set_fact:
        flink_job_map: {}
      run_once: true

    - name: Add jobs from each host
      set_fact:
        flink_job_map: >-
          {{
            flink_job_map | combine(
              dict(
                (flink_job | default([])) | zip([inventory_hostname] * (flink_job | default([]) | length))
              )
            )
          }}

===============================================================
---
- name: Build flink_job dictionary
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Init empty dict
      set_fact:
        flink_job_map: {}

    - name: Collect jobs from each host
      set_fact:
        flink_job_map: >-
          {{
            flink_job_map
            | combine(
                dict(
                  hostvars[item].flink_job | default([]) 
                  | zip([item] * (hostvars[item].flink_job | default([]) | length))
                )
              )
          }}
      loop: "{{ groups['test_flink'] }}"

    - name: Show result
      debug:
        var: flink_job_map

=========================================================
---
- name: Build flink_job dictionary
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Init empty dict
      set_fact:
        flink_job_map: {}

    - name: Add jobs from each host in test_flink
      set_fact:
        flink_job_map: >-
          {{
            flink_job_map | combine(
              dict(
                (hostvars[item].flink_job | default([]))
                | zip([item] * (hostvars[item].flink_job | default([]) | length))
              )
            )
          }}
      loop: "{{ groups['test_flink'] }}"

    - name: Show result
      debug:
        var: flink_job_map

============================================================

3. Ğ•ÑĞ»Ğ¸ Ğ¾Ñ‡ĞµĞ½ÑŒ Ñ…Ğ¾Ñ‡ĞµÑ‚ÑÑ ini-Ğ¸Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ ğŸ˜…

ĞœĞ¾Ğ¶Ğ½Ğ¾ Ñ‚Ğ°Ğº:

[test_flink]
server1.localhost.ru flink_job="aaaa,bbbb,cccc"
server2.localhost.ru flink_job="dddd,eeee,ffff"


Ğ Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ² Ğ¿Ğ»ĞµĞ¹Ğ±ÑƒĞºĞµ Ğ¿Ñ€ĞµĞ²Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ² ÑĞ¿Ğ¸ÑĞ¾Ğº:

- set_fact:
    flink_job_list: "{{ flink_job.split(',') }}"

============================================================

---
- name: Build flink_job dictionary
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Init empty dict
      set_fact:
        flink_job_map: {}

    - name: Collect jobs from each host
      set_fact:
        flink_job_map: >-
          {{
            flink_job_map
            | combine(
                dict(
                  (hostvars[item].flink_job | default("") | split(","))
                  | zip([item] * (hostvars[item].flink_job | default("") | split(",") | length))
                )
              )
          }}
      loop: "{{ groups['test_flink'] }}"

    - name: Show result
      debug:
        var: flink_job_map

